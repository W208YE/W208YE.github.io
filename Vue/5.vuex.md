## 5.1 ç†è§£Vuex

### 5.1.1 Vuexæ˜¯ä»€ä¹ˆ

æ¦‚å¿µï¼šä¸“é—¨åœ¨`vue`ä¸­å®ç°é›†ä¸­å¼çŠ¶æ€(æ•°æ®)ç®¡ç†çš„ä¸€ä¸ª`vue`æ’ä»¶, å¯¹`Vue`åº”ç”¨ä¸­å¤šä¸ªç»„ä»¶çš„å…±äº«çŠ¶æ€è¿›è¡Œé›†ä¸­å¼çš„ç®¡ç†(è¯»/å†™), ä¹Ÿæ˜¯ä¸€ç§ç»„ä»¶é—´é€šä¿¡çš„æ–¹å¼, ä¸”é€‚ç”¨äºä»»æ„ç»„ä»¶é—´é€šä¿¡

### 5.1.2 ä»€ä¹ˆæ—¶å€™ç”¨Vuex

1. å¤šä¸ªç»„ä»¶ä¾èµ–äºåŒä¸€çŠ¶æ€
2. æ¥è‡ªä¸åŒç»„ä»¶çš„è¡Œä¸ºéœ€è¦å˜æ›´åŒä¸€çŠ¶æ€

### 5.1.3 VuexåŸç†å›¾

![vuex](D:\æ¡Œé¢\vuex.png)

## 5.2 æ±‚å’Œæ¡ˆä¾‹

### 5.2.1 ä½¿ç”¨çº¯vueç¼–å†™

**src/App.vue**

```javascript
<template>
  <div>
    <Count/>
  </div>
</template>

<script>
import Count from "./components/Count.vue";

export default {
  name: "App",
  components: { Count },
};
</script>
```

**src/components/Count.vue**

```javascript
<template>
  <div>
    <h2>å½“å‰æ±‚å’Œä¸ºï¼š{{ sum }}</h2>
    <select v-model.number="n">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>
    <button @click="increment">+</button>
    <button @click="decrement">-</button>
    <button @click="incrementOdd">å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ </button>
    <button @click="incrementWait">ç­‰ä¸€ç­‰å†åŠ </button>
  </div>
</template>

<script>
  export default {
    name: "Count",
    data() {
      return {
        sum: 0, // å½“å‰çš„å’Œ
        n: 1, // ç”¨æˆ·é€‰æ‹©çš„æ•°å­—
      };
    },
    methods: {
      increment() {
        this.sum += this.n;
      },
      decrement() {
        this.sum -= this.n;
      },
      incrementOdd() {
        if (this.sum % 2) {
          this.sum += this.n;
        }
      },
      incrementWait() {
        setTimeout(() => {
          this.sum += this.n;
        }, 500);
      },
    },
  };
</script>

<style>
  button {margin-left: 5px;}
</style>
```

### 5.2.2 å¡”å°–Vuexç¯å¢ƒ

1. ä¸‹è½½å®‰è£…`vuex` `npm i vuex@3`
2. åˆ›å»º`src/store/index.js`è¯¥æ–‡ä»¶ç”¨äºåˆ›å»º`vuex`ä¸­æœ€ä¸ºæ ¸å¿ƒçš„`store`

```javascript
import Vue from 'vue'
import Vuex from 'vuex'	// å¼•å…¥Vuex

Vue.use(Vuex)	// åº”ç”¨Vuexæ’ä»¶

const actions = {}		// å‡†å¤‡actionsâ€”â€”ç”¨äºå“åº”ç»„ä»¶ä¸­çš„åŠ¨ä½œ
const mutations = {}	// å‡†å¤‡mutationsâ€”â€”ç”¨äºæ“ä½œæ•°æ®ï¼ˆstateï¼‰
const state = {}			// å‡†å¤‡stateâ€”â€”ç”¨äºå­˜å‚¨æ•°æ®

// åˆ›å»ºå¹¶æš´éœ²store
export default new Vuex.Store({
	actions,
	mutations,
	state,
})
```

3. åœ¨`src/main.js`ä¸­åˆ›å»º`vm`æ—¶ä¼ å…¥`store`é…ç½®é¡¹

```javascript
import Vue from 'vue'
import App from './App.vue'
import store from './store'	// å¼•å…¥store

Vue.config.productionTip = false

new Vue({
	el: '#app',
	render: h => h(App),
	store,										// é…ç½®é¡¹æ·»åŠ store
	beforeCreate() {
		Vue.prototype.$bus = this
	}
})
```

### 5.2.3 ä½¿ç”¨Vuexç¼–å†™

Vuexçš„åŸºæœ¬ä½¿ç”¨

1. åˆå§‹åŒ–æ•°æ®`state`, é…ç½®`actions, mutations`, æ“ä½œæ–‡ä»¶`store.js`

2. ç»„ä»¶ä¸­è¯»å–`vuex`ä¸­çš„æ•°æ®`$store.state.æ•°æ®`

3. ç»„ä»¶ä¸­ä¿®æ”¹`vuex`ä¸­çš„æ•°æ®`$store.dispatch('actionä¸­çš„æ–¹æ³•å', æ•°æ®)`æˆ–è€…`$store.commit('mutationsä¸­çš„æ–¹æ³•å', æ•°æ®)`

   è‹¥æ²¡æœ‰ç½‘ç»œè¯·æ±‚æˆ–å…¶ä»–ä¸šåŠ¡é€»è¾‘, ç»„ä»¶ä¸­ä¹Ÿå¯è¶Šè¿‡`actions`, å³ä¸å†™`dispatch`, ç›´æ¥ç¼–å†™`commit`

**src/store/index.js**è¯¥æ–‡ä»¶ç”¨äºåˆ›å»ºVuexä¸­æœ€ä¸ºæ ¸å¿ƒçš„store

```javascript
import Vue from 'vue'
import Vuex from 'vuex'	// å¼•å…¥Vuex

Vue.use(Vuex)	// åº”ç”¨Vuexæ’ä»¶

// å‡†å¤‡actionsâ€”â€”ç”¨äºå“åº”ç»„ä»¶ä¸­çš„åŠ¨ä½œ
const actions = {
	/* jia(context,value){
		console.log('actionsä¸­çš„jiaè¢«è°ƒç”¨äº†')
		context.commit('JIA',value)
	},
	jian(context,value){
		console.log('actionsä¸­çš„jianè¢«è°ƒç”¨äº†')
		context.commit('JIAN',value)
	}, */
	jiaOdd(context,value){	// context ç›¸å½“äºç²¾ç®€ç‰ˆçš„ $store
		console.log('actionsä¸­çš„jiaOddè¢«è°ƒç”¨äº†')
		if(context.state.sum % 2){
			context.commit('JIA',value)
		}
	},
	jiaWait(context,value){
		console.log('actionsä¸­çš„jiaWaitè¢«è°ƒç”¨äº†')
		setTimeout(()=>{
			context.commit('JIA',value)
		},500)
	}
}
// å‡†å¤‡mutationsâ€”â€”ç”¨äºæ“ä½œæ•°æ®ï¼ˆstateï¼‰
const mutations = {
	JIA(state,value){
		console.log('mutationsä¸­çš„JIAè¢«è°ƒç”¨äº†')
		state.sum += value
	},
	JIAN(state,value){
		console.log('mutationsä¸­çš„JIANè¢«è°ƒç”¨äº†')
		state.sum -= value
	}
}
// å‡†å¤‡stateâ€”â€”ç”¨äºå­˜å‚¨æ•°æ®
const state = {
	sum:0 //å½“å‰çš„å’Œ
}

// åˆ›å»ºå¹¶æš´éœ²store
export default new Vuex.Store({
	actions,
	mutations,
	state,
})
```

**src/components/Count.vue**

```javascript
<template>
	<div>
		<h1>å½“å‰æ±‚å’Œä¸ºï¼š{{ $store.state.sum }}</h1>
		<select v-model.number="n">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
		</select>
		<button @click="increment">+</button>
		<button @click="decrement">-</button>
		<button @click="incrementOdd">å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ </button>
		<button @click="incrementWait">ç­‰ä¸€ç­‰å†åŠ </button>
	</div>
</template>

<script>
	export default {
		name:'Count',
		data() {
			return {
				n:1, //ç”¨æˆ·é€‰æ‹©çš„æ•°å­—
			}
		},
		methods: {
			increment(){
				this.$store.commit('JIA',this.n)
			},
			decrement(){
				this.$store.commit('JIAN',this.n)
			},
			incrementOdd(){
				this.$store.dispatch('jiaOdd',this.n)
			},
			incrementWait(){
				this.$store.dispatch('jiaWait',this.n)
			},
		}
	}
</script>

<style lang="css">button{margin-left: 5px;}</style>

```

## 5.3 gettersé…ç½®é¡¹

1. æ¦‚å¿µ: å½“`state`ä¸­çš„æ•°æ®éœ€è¦ç»è¿‡åŠ å·¥åå†ä½¿ç”¨æ—¶, å¯ä»¥ä½¿ç”¨`getters`åŠ å·¥, ç›¸å½“äº **å…¨å±€è®¡ç®—å±æ€§**
2. åœ¨`store.js`ä¸­è¿½åŠ `getters`é…ç½®

```javascript
......

const getters = {
	bigSum(state){
		return state.sum * 10
	}
}

// åˆ›å»ºå¹¶æš´éœ²store
export default new Vuex.Store({
	......
	getters
})
```

3. ç»„ä»¶ä¸­è¯»å–æ•°æ®`$store.getters.bigSum`

   **src/store/index.js**

```javascript
import Vue from 'vue'	// å¼•å…¥Vueæ ¸å¿ƒåº“
import Vuex from 'vuex'	// å¼•å…¥Vuex

Vue.use(Vuex)	// åº”ç”¨Vuexæ’ä»¶
   
// å‡†å¤‡actionså¯¹è±¡â€”â€”å“åº”ç»„ä»¶ä¸­ç”¨æˆ·çš„åŠ¨ä½œ
const actions = {
    addOdd(context,value){
        console.log("actionsä¸­çš„addOddè¢«è°ƒç”¨äº†")
        if(context.state.sum % 2){context.commit('ADD',value)}
    },
    addWait(context,value){
        console.log("actionsä¸­çš„addWaitè¢«è°ƒç”¨äº†")
        setTimeout(()=>{context.commit('ADD',value)},500)
    },
}
// å‡†å¤‡mutationså¯¹è±¡â€”â€”ä¿®æ”¹stateä¸­çš„æ•°æ®
const mutations = {
    ADD(state,value){state.sum += value},
    SUB(state,value){state.sum -= value}
}
// å‡†å¤‡stateå¯¹è±¡â€”â€”ä¿å­˜å…·ä½“çš„æ•°æ®
const state = {
    sum:0 // å½“å‰çš„å’Œ
}
// å‡†å¤‡getterså¯¹è±¡â€”â€”ç”¨äºå°†stateä¸­çš„æ•°æ®è¿›è¡ŒåŠ å·¥
const getters = {
    bigSum(){
        return state.sum * 10
    }
}
   
//åˆ›å»ºå¹¶æš´éœ²store
export default new Vuex.Store({
    actions,
    mutations,
    state,
    getters
})
```

**src/Count.vue**

```javascript
<template>
	<div>
		<h1>å½“å‰æ±‚å’Œä¸ºï¼š{{ $store.state.sum }}</h1>
		<h3>å½“å‰æ±‚å’Œçš„10å€ä¸ºï¼š{{ $store.getters.bigSum }}</h3>
		<select v-model.number="n">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
		</select>
		<button @click="increment">+</button>
		<button @click="decrement">-</button>
		<button @click="incrementOdd">å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ </button>
		<button @click="incrementWait">ç­‰ä¸€ç­‰å†åŠ </button>
	</div>
</template>

<script>
	export default {
		name:'Count',
		data() {
			return {
				n:1,
			}
		},
		methods: {
			increment(){this.$store.commit('ADD',this.n)},
			decrement(){this.$store.commit('SUBTRACT',this.n)},
			incrementOdd(){this.$store.dispatch('addOdd',this.n)},
			incrementWait(){this.$store.dispatch('addWait',this.n)},
		},
	}
</script>

<style>button{margin-left: 5px;}</style>
```

## 5.4.å››ä¸ªmapæ–¹æ³•çš„ä½¿ç”¨

1. <strong>mapStateæ–¹æ³•ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬æ˜ å°„```state```ä¸­çš„æ•°æ®ä¸ºè®¡ç®—å±æ€§

   ```js
   computed: {
       //å€ŸåŠ©mapStateç”Ÿæˆè®¡ç®—å±æ€§ï¼šsumã€schoolã€subjectï¼ˆå¯¹è±¡å†™æ³•ï¼‰
        ...mapState({sum:'sum',school:'school',subject:'subject'}),
            
       //å€ŸåŠ©mapStateç”Ÿæˆè®¡ç®—å±æ€§ï¼šsumã€schoolã€subjectï¼ˆæ•°ç»„å†™æ³•ï¼‰
       ...mapState(['sum','school','subject']),
   },
   ```

2. <strong>mapGettersæ–¹æ³•ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬æ˜ å°„```getters```ä¸­çš„æ•°æ®ä¸ºè®¡ç®—å±æ€§

   ```js
   computed: {
       //å€ŸåŠ©mapGettersç”Ÿæˆè®¡ç®—å±æ€§ï¼šbigSumï¼ˆå¯¹è±¡å†™æ³•ï¼‰
       ...mapGetters({bigSum:'bigSum'}),
   
       //å€ŸåŠ©mapGettersç”Ÿæˆè®¡ç®—å±æ€§ï¼šbigSumï¼ˆæ•°ç»„å†™æ³•ï¼‰
       ...mapGetters(['bigSum'])
   },
   ```

3. <strong>mapActionsæ–¹æ³•ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸```actions```å¯¹è¯çš„æ–¹æ³•ï¼Œå³ï¼šåŒ…å«```$store.dispatch(xxx)```çš„å‡½æ•°

   ```js
   methods:{
       //é mapActionsç”Ÿæˆï¼šincrementOddã€incrementWaitï¼ˆå¯¹è±¡å½¢å¼ï¼‰
       ...mapActions({incrementOdd:'jiaOdd',incrementWait:'jiaWait'})
   
       //é mapActionsç”Ÿæˆï¼šincrementOddã€incrementWaitï¼ˆæ•°ç»„å½¢å¼ï¼‰
       ...mapActions(['jiaOdd','jiaWait'])
   }
   ```

4. <strong>mapMutationsæ–¹æ³•ï¼š</strong>ç”¨äºå¸®åŠ©æˆ‘ä»¬ç”Ÿæˆä¸```mutations```å¯¹è¯çš„æ–¹æ³•ï¼Œå³ï¼šåŒ…å«```$store.commit(xxx)```çš„å‡½æ•°

   ```js
   methods:{
       //é mapActionsç”Ÿæˆï¼šincrementã€decrementï¼ˆå¯¹è±¡å½¢å¼ï¼‰
       ...mapMutations({increment:'JIA',decrement:'JIAN'}),
       
       //é mapMutationsç”Ÿæˆï¼šJIAã€JIANï¼ˆå¯¹è±¡å½¢å¼ï¼‰
       ...mapMutations(['JIA','JIAN']),
   }
   ```

> å¤‡æ³¨ï¼šmapActionsä¸mapMutationsä½¿ç”¨æ—¶ï¼Œè‹¥éœ€è¦ä¼ é€’å‚æ•°éœ€è¦ï¼šåœ¨æ¨¡æ¿ä¸­ç»‘å®šäº‹ä»¶æ—¶ä¼ é€’å¥½å‚æ•°ï¼Œå¦åˆ™å‚æ•°æ˜¯äº‹ä»¶å¯¹è±¡ã€‚

**src/components/Count.vue**

```javascript
<template>
	<div>
		<h1>å½“å‰æ±‚å’Œä¸ºï¼š{{ sum }}</h1>
		<h3>å½“å‰æ±‚å’Œçš„10å€ä¸ºï¼š{{ bigSum }}</h3>
		<h3>æˆ‘æ˜¯{{ name }}ï¼Œæˆ‘åœ¨{{ school }}å­¦ä¹ </h3>
		<select v-model.number="n">
			<option value="1">1</option>
			<option value="2">2</option>
			<option value="3">3</option>
		</select>
		<button @click="increment(n)">+</button>
		<button @click="decrement(n)">-</button>
		<button @click="addOdd(n)">å½“å‰æ±‚å’Œä¸ºå¥‡æ•°å†åŠ </button>
		<button @click="addWait(n)">ç­‰ä¸€ç­‰å†åŠ </button>
	</div>
</template>

<script>
	import {mapState, mapGetters, mapMutations, mapActions} from 'vuex'	//ğŸ”´

	export default {
		name: 'Count',
		data() {
			return {
				n:1, //ç”¨æˆ·é€‰æ‹©çš„æ•°å­—
			}
		},
  computed: {		
			...mapState(['sum','school','name']),
			...mapGetters(['bigSum'])
		},
		methods: {
			...mapMutations({increment:'ADD', decrement:'SUBTRACT'}),
			...mapActions(['addOdd', 'addWait'])
		},
	}
</script>

<style>
	button{
		margin-left: 5px;
	}
</style>
```

## 5.5 å¤šç»„ä»¶å…±äº«æ•°æ®æ¡ˆä¾‹



## 5.6 æ¨¡å—åŒ–+å‘½åç©ºé—´

1. ç›®çš„: è®©ä»£ç æ›´å¥½ç»´æŠ¤, è®©å¤šç§æ•°æ®åˆ†ç±»æ›´åŠ æ˜ç¡®

2. ä¿®æ”¹`store.js`

   ä¸ºäº†è§£å†³ä¸åŒæ¨¡å—å‘½åå†²çªçš„é—®é¢˜, å°†ä¸åŒæ¨¡å—çš„`namespaced:true`, ä¹‹ååœ¨ä¸åŒé¡µé¢ä¸­å¼•å…¥`getter actions mutations`æ—¶, éœ€è¦åŠ ä¸Šæ‰€å±çš„æ¨¡å—å

```javascript
const countAbout = {
  namespaced: true,	// å¼€å¯å‘½åç©ºé—´
  state: {x:1},
  mutations: { ... },
  actions: { ... },
  getters: {
    bigSum(state){ return state.sum * 10 }
  }
}

const personAbout = {
  namespaced: true,	// å¼€å¯å‘½åç©ºé—´
  state: { ... },
  mutations: { ... },
  actions: { ... }
}

const store = new Vuex.Store({
  modules: {
    countAbout,
    personAbout
  }
})
```

3. å¼€å¯å‘½åç©ºé—´å, ç»„ä»¶ä¸­è¯»å–`state`æ•°æ®

```javascript
// æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥è¯»å–
this.$store.state.personAbout.list
// æ–¹å¼äºŒï¼šå€ŸåŠ©mapStateè¯»å–ï¼š
...mapState('countAbout',['sum','school','subject']),
```

4. å¼€å¯å‘½åç©ºé—´å, ç»„ä»¶ä¸­è¯»å–`getters`æ•°æ®

```javascript
//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥è¯»å–
this.$store.getters['personAbout/firstPersonName']
//æ–¹å¼äºŒï¼šå€ŸåŠ©mapGettersè¯»å–ï¼š
...mapGetters('countAbout',['bigSum'])
```

5. å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è°ƒç”¨dispatch

```js
//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥dispatch
this.$store.dispatch('personAbout/addPersonWang',person)
//æ–¹å¼äºŒï¼šå€ŸåŠ©mapActionsï¼š
...mapActions('countAbout',{incrementOdd:'jiaOdd',incrementWait:'jiaWait'})
```

6. å¼€å¯å‘½åç©ºé—´åï¼Œç»„ä»¶ä¸­è°ƒç”¨commit

```js
//æ–¹å¼ä¸€ï¼šè‡ªå·±ç›´æ¥commit
this.$store.commit('personAbout/ADD_PERSON',person)
//æ–¹å¼äºŒï¼šå€ŸåŠ©mapMutationsï¼š
...mapMutations('countAbout',{increment:'JIA',decrement:'JIAN'}),
```